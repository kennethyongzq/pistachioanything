<!doctype html>
<html>

<head>
  <title>Test</title>
  <!-- Include Ecwid JS SDK -->
  <script src="https://djqizrxa6f10j.cloudfront.net/ecwid-sdk/js/1.2.8/ecwid-app.js"></script>

  <script>
    // Initialize the application
    EcwidApp.init({
      app_id: "custom-app-33883008-3", // your client_id
      autoloadedflag: true, 
      autoheight: true
    });

    // Get the store ID and access token
    var storeData = EcwidApp.getPayload();
    var storeId = storeData.store_id;
    var accessToken = storeData.access_token;
    var language = storeData.lang;

    if (storeData.public_token !== undefined){
      var publicToken = storeData.public_token;
    }
    
    if (storeData.app_state !== undefined){
      var appState = storeData.app_state;
    }

    // do something...
  </script>
  <!-- Jquery -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>
  <link rel="stylesheet" href="https://code.jquery.com/ui/1.9.1/themes/base/jquery-ui.css">
  <!-- Include Ecwid CSS Framework -->
  <link rel="stylesheet" href="https://d35z3p2poghz10.cloudfront.net/ecwid-sdk/css/1.3.13/ecwid-app-ui.css"/>  
</head>

<body class='normalized'>
<div>
	<div class="a-card a-card--normal">
		<div class="a-card__paddings">
			<div class="form-area">
				<div class="form-area__title form-area__title--small">Date Changer13</div>
				<div class="form-area__content">
					<p>Please key in the order number to change the date</p>
					<div class="fieldsets-batch">
						<div class="fieldset">
							<div class="field field--medium">
								<label class="field__label">Order Number</label>
								<input id="order_no" type="number" class="field__input" tabindex="4" maxlength="64">
								<div class="field__placeholder">Order Number</div>
							</div>
						</div>
						<div class="fieldset">
							<div class="field field--medium">
								<label class="field__label">Date</label>
								<input id="order_date" type="text" class="field__input" tabindex="4" maxlength="64">
								<div class="field__placeholder">Date</div>
							</div>
						</div>

					</div>
				</div>
				<div class="form-area__action">
					<button type="button" onclick="onSaveClick()" class="btn btn-primary btn-medium">Save</button>
				</div>
				<h5>Log:</h5>
				<p id="krstest"></p>
			</div>
		</div>
	</div>
</div>

<!-- JS for CSS Framework components -->
  <script src="https://d35z3p2poghz10.cloudfront.net/ecwid-sdk/css/1.3.13/ecwid-app-ui.min.js"></script>
<script>
	$(document).ready(function(){
	$( "#order_date" ).datepicker({dateFormat: "dd M yy"});
	
	});
	function krslog(text){
		var obj = $("#krstest").text($("#krstest").text()+"<br>"+"Error: Http Response "+text);	
		obj.html(obj.html().replace(/\n/g,'<br/>'));
	}
	function onSaveClick(){
		//$("#krstest").text($("#order_no").val());	
		var order_no = $("#order_no").val();
		krslog("Getting Order No " + order_no);
		var jsDate = $('#order_date').datepicker('getDate');
		if (jsDate !== null) { // if any date selected in datepicker
		    if (jsDate instanceof Date){// -> true
		        var order_date = jsDate.getDate();
		        jsDate.getMonth();
		        jsDate.getFullYear();
		        krslog("Updating with Date = " + order_date);	 
		    }
		    else{
		        krslog("Error:jsDate is not Date Instance");	    
		    }
		}
		else{
    		    krslog("Error:Date is null");
		}
		
		var xhttp = new XMLHttpRequest();

		var requestURL = "https://app.ecwid.com/api/v3/"+storeId+"/orders/"+order_no+"?token="+accessToken
		krslog("requestURL:" + requestURL);
		xhttp.open("GET", requestURL, true);
		xhttp.send();

		xhttp.onreadystatechange = function() {
		  
		  krslog("xhttp.readyState = " + xhttp.readyState);
		  krslog("xhttp.status = " + xhttp.status);
		  if (xhttp.readyState == 4 && xhttp.status == 200) {
		    var apiResponse = xhttp.responseText;
		    krslog("Success: ID = " + apiResponse.orderid);

		  }
		};


	}
	
	

	</script>
</body>

</html>
